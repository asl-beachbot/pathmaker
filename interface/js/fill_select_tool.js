// Generated by CoffeeScript 1.7.1
(function() {
  var curr_zoom, endVector, handle, hitOptions, movePath, oldcenter, path, project, segment, startVector, tool, vector;

  window.fill_select_tool = new paper.Tool();

  tool = fill_select_tool;

  tool.minDistance = 1;

  tool.activate();

  movePath = false;

  project = paper.project;

  segment = path = oldcenter = handle = null;

  hitOptions = {
    fill: true,
    segments: true,
    tolerance: 10,
    stroke: true
  };

  startVector = endVector = vector = null;

  tool.onMouseDown = function(event) {
    var hitResult, location, prev_selected, seg, _i, _len;
    prev_selected = paper.project.selectedItems;
    paper.project.deselectAll();
    segment = path = null;
    if (movePath) {
      startVector = event.point;
    }
    for (_i = 0, _len = filled_segments.length; _i < _len; _i++) {
      seg = filled_segments[_i];
      hitResult = seg.hitTest(event.point, hitOptions);
      if (hitResult) {
        break;
      }
    }
    if (!hitResult) {
      return;
    }
    hitResult.item.selected = true;
    if (hitResult.item.is_segment) {
      console.log("selected a segment!");
      $("#select_fill").show();
    }
    if (hitResult) {
      path = hitResult.item;
      if (hitResult.type === 'segment') {
        segment = hitResult.segment;
      } else if (hitResult.type === 'stroke') {
        location = hitResult.location;
      } else if (hitResult.type === 'handle-in') {
        handle = hitResult.segment.handleIn;
      } else if (hitResult.type === 'handle-out') {
        handle = hitResult.segment.handleOut;
      }
    }
    return movePath = hitResult.type === 'fill';
  };

  tool.onMouseDrag = function(event) {
    if (startVector) {
      endVector = event.point;
      if (vector) {
        vector.remove();
      }
      vector = new paper.Path(startVector, endVector);
      vector.strokeColor = 'red';
      vector.strokeWidth = 4;
      return;
    }
    if (segment) {
      console.log(segment.point);
      segment.point = segment.point.add(event.delta);
      return console.log(segment.point);
    } else if (path) {
      return path.position = path.position.add(event.delta);
    } else if (handle) {
      return handle.position = handle.position.add(event.delta);
    }
  };

  curr_zoom = 1;

}).call(this);
